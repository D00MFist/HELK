# HELK esf output conf file
# Author: Leo Pitt
# License: GPL-3.0

filter {
  if [message] {
    mutate {
      add_field => {
          "etl_pipeline" => "all-filter-0098"
          "etl_version" => "2020.04.19.01"
      }
      rename => {
        #"[@metadata][kafka][consumer_group]" => "etl_kafka_consumer_group"
        #"[@metadata][kafka][key]" => "etl_kafka_key"
        "[@metadata][kafka][offset]" => "etl_kafka_offset"
        "[@metadata][kafka][partition]" => "etl_kafka_partition"
        "[@metadata][kafka][timestamp]" => "etl_kafka_time"
        "[@metadata][kafka][topic]" => "etl_kafka_topic"
      }
      copy => { "message" => "event_original_message" }
    }
    json {
      source => "message"
      target => "esf"
    }
    ruby {
      code => "event.set('etl_processed_time', Time.now().utc);"
      add_field => { "etl_pipeline" => "all-add_processed_timestamp" }
    }
  }
}

output {
  if [log.file.path] == "/var/log/esf.log" {
    elasticsearch {
      hosts => ["helk-elasticsearch:9200"]
      index => "logs-endpoint-esf-%{+YYYY.MM.dd}"
      document_id => "%{[@metadata][log_hash]}"
      user => 'elastic'
      #password => 'elasticpassword'
    }
  }
}


